<!DOCTYPE html>
<html>
  <body>
    <h3>–í—ã–±–µ—Ä–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—é</h3>
    <select id="collection-select"></select>

    <div style="margin-top: 10px;">
      <label>
        <input type="checkbox" id="show-all" />
        –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
      </label>
    </div>

    <button id="analyze" style="margin-top: 10px;">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>

    <script>
      console.log("UI loaded!");

      let selectedId = null;

      // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –æ—Ç –ø–ª–∞–≥–∏–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º select
      onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (msg.type === "collections") {
          const select = document.getElementById("collection-select");
          msg.data.forEach(col => {
            const option = document.createElement("option");
            option.value = col.id;
            option.textContent = col.name;
            select.appendChild(option);
          });
          selectedId = msg.data[0]?.id || null;
        }
      };

      // –°–ª—É—à–∞–µ–º –≤—ã–±–æ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏
      document.getElementById("collection-select").addEventListener("change", (e) => {
        selectedId = e.target.value;
      });

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ code.ts —Å–∏–≥–Ω–∞–ª –Ω–∞ –∞–Ω–∞–ª–∏–∑
      document.getElementById("analyze").addEventListener("click", () => {
        const showAll = document.getElementById("show-all").checked;

        if (selectedId) {
          parent.postMessage(
            {
              pluginMessage: {
                type: "collectionSelected",
                collectionId: selectedId,
                showAll: showAll // üëà –í–ê–ñ–ù–û: –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è showAll, –Ω–µ showAllVariables
              }
            },
            "*"
          );
        }
      });
    </script>
  </body>
</html>
